/*! orb v0.1.0, Javascript pivot grid library.
 *  (c) Najmeddine Nouri, 2014-11-11.
 *  Licence: MIT.
 */

orb={},orb.utils={ns:function(a){for(var b=a.split("."),c=window,d=0;d<b.length;)c[b[d]]=c[b[d]]||{},c=c[b[d]],d++;return c},ownProperties:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},isArray:function(a){return"[object Array]"===Object.prototype.toString.apply(a)},jsonStringify:function(a,b){function c(a,c){return b&&b.indexOf(a)>-1?void 0:c}return JSON.stringify(a,c,2)}},function(){function a(a,b,c){for(var d=0;d<b.length;d++)if(void 0!==b[d][a])return b[d][a];return c}function b(){for(var b=[],c=[],d=[],e=0;e<arguments.length;e++){var f=arguments[e]||{};b.push(f),c.push(f.sort||{}),d.push(f.subtotal||{})}return{name:a("name",b,""),caption:a("caption",b,""),aggregatefunc:a("aggregatefunc",b,null),filter:a("filter",b,null),sort:{order:a("order",c,null),customfunc:a("customfunc",c,null)},subtotal:{visible:a("visible",d,!0),collapsible:a("collapsible",d,!0),collapsed:a("collapsed",d,!1)}}}function c(a,c,d){var e;switch(a){case orb.axe.Type.ROWS:e=d.rowsettings;break;case orb.axe.Type.COLUMNS:e=d.columnsettings;break;case orb.axe.Type.DATA:e=d.datasettings;break;default:e=null}return b(c,e,d)}orb.field=function(a){a=a||{},this.name=a.name,this.caption=a.caption,this.aggregatefunc=a.aggregatefunc,this.filter=a.filter;var b=a.sort||{};this.sort={order:b.order,customfunc:b.customfunc};var c=a.subtotal||{};this.subtotal={visible:void 0!==c.visible?c.visible:!0,collapsible:void 0!==c.collapsible?c.collapsible:!0,collapsed:void 0!==c.collapsed?c.collapsed:!1},this.rowsettings=a.rowsettings,this.columnsettings=a.columnsettings,this.datasettings=a.datasettings},orb.config=function(a){function b(a,b){var c=d(a,b);return c>-1?a[c]:null}function d(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return c;return-1}var e=this;this.datasource=a.datasource,this.showgrandtotal=a.showgrandtotal===!1?!1:!0,this.showsubtotals=a.showsubtotals===!1?!1:!0,this.allfields=(a.fields||[]).map(function(a){return new orb.field(a)}),this.rowfields=(a.rows||[]).map(function(a){return c(orb.axe.Type.ROWS,a,b(e.allfields,a.name))}),this.columnfields=(a.columns||[]).map(function(a){return c(orb.axe.Type.COLUMNS,a,b(e.allfields,a.name))}),this.datafields=(a.data||[]).map(function(a){return c(orb.axe.Type.DATA,a,b(e.allfields,a.name))}),e.availablefields=function(){return e.allfields.filter(function(a){var b=function(b){return a.name!==b.name};return e.datafields.every(b)&&e.rowfields.every(b)&&e.columnfields.every(b)})},this.moveField=function(a,f,g,h){var i,j,k,l=b(e.allfields,a);if(l){switch(f){case orb.axe.Type.ROWS:i=e.rowfields;break;case orb.axe.Type.COLUMNS:i=e.columnfields;break;case orb.axe.Type.DATA:i=e.datafields}switch(g){case orb.axe.Type.ROWS:k=e.rowfields;break;case orb.axe.Type.COLUMNS:k=e.columnfields;break;case orb.axe.Type.DATA:k=e.datafields}if(i||k){if(i){if(j=d(i,a),f===g&&(j==i.length-1&&null==h||j===h-1))return!1;i.splice(j,1)}return l=c(g,null,l),k&&(null!=h?k.splice(h,0,l):k.push(l)),!0}}}}}(),function(){orb.dimension=function(a,b,c,d,e,f,g){var h=this;this.id=a,this.parent=b,this.value=c,this.isRoot=f,this.isLeaf=g,this.field=d,this.depth=e,this.values=[],this.subdimvals={},this.rowIndexes=null,this.getRowIndexes=function(a){if(null==h.rowIndexes){this.rowIndexes=[];for(var b=0;b<h.values.length;b++)h.subdimvals[h.values[b]].getRowIndexes(this.rowIndexes)}if(null!=a){for(var c=0;c<h.rowIndexes.length;c++)a.push(h.rowIndexes[c]);return a}return h.rowIndexes}}}(),function(){orb.axe=function(a,b){function c(a){for(var b=0;b<e.fields.length;b++)if(e.fields[b].name===a.name)return b;return-1}function d(){if(null!=e.pgrid.config.datasource&&e.dimensionsCount>0){var a=e.pgrid.config.datasource;if(null!=a&&orb.utils.isArray(a)&&a.length>0)for(var b=0,c=a.length;c>b;b++)for(var d=a[b],g=e.root,h=0;h<e.dimensionsCount;h++){var i=e.dimensionsCount-h,j=e.fields[h],k=d[j.name],l=g.subdimvals;void 0!==l[k]?g=l[k]:(g.values.push(k),g=new orb.dimension(++f,g,k,j,i,!1,h==e.dimensionsCount-1),l[k]=g,g.rowIndexes=[],e.dimensionsByDepth[i].push(g)),g.rowIndexes.push(b)}}}var e=this,f=0;null!=a&&null!=a.config&&(this.pgrid=a,this.type=b,this.fields=function(){switch(b){case orb.axe.Type.COLUMNS:return e.pgrid.config.columnfields;case orb.axe.Type.ROWS:return e.pgrid.config.rowfields;case orb.axe.Type.DATA:return e.pgrid.config.datafields;default:return[]}}(),this.dimensionsCount,this.root,this.dimensionsByDepth,this.update=function(){e.dimensionsCount=e.fields.length,e.root=new orb.dimension(++f,null,null,null,e.dimensionsCount+1,!0),e.dimensionsByDepth={};for(var a=1;a<=e.dimensionsCount;a++)e.dimensionsByDepth[a]=[];d();for(var b=0;b<e.fields.length;b++){var c=e.fields[b];("asc"===c.sort.order||"desc"===c.sort.order)&&e.sort(c,!0)}},this.sort=function(a,b){if(null!=a){b!==!0&&(a.sort.order="asc"!==a.sort.order?"asc":"desc");for(var d=e.dimensionsCount-c(a),f=d===e.dimensionsCount?[e.root]:e.dimensionsByDepth[d+1],g=0;g<f.length;g++)f[g].values.sort(),"desc"===a.sort.order&&f[g].values.reverse()}},this.update())},orb.axe.Type={COLUMNS:1,ROWS:2,DATA:3}}(),function(){orb.pgrid=function(a){function b(a,b,c){var d;if(null==a)d=b;else if(null==b)d=a;else{d=[];for(var e=0;e<a.length;e++){var g=a[e];if(g>=0){var h=b.indexOf(g);h>=0&&(a[e]=0-(g+2),d.push(g))}}}var i,j=f.config.datasource,k=f.config.datafields[0];if(k)if(k.aggregatefunc)i=k.aggregatefunc(k.name,d,j,c,b);else{var l=null!=d;if(d=d||j,d.length>0){for(var m=0,n=0;n<d.length;n++){var o=d[n];l?o>=0&&(m+=j[o][k.name]):m+=o[k.name]}i=m}}return i}function c(a){if(a){var c={},d="r"+a.id;if(void 0===e[d]&&(e[d]=a.isRoot?null:e[a.parent.id]||a.getRowIndexes()),c[f.columns.root.id]=b(a.isRoot?null:e[d].slice(0),null),f.columns.dimensionsCount>0)for(var g=0,h=[f.columns.root];g<h.length;){for(var i=h[g],j=a.isRoot?null:i.isRoot?e[d].slice(0):e["c"+i.id].slice(0),k=0;k<i.values.length;k++){var l=i.subdimvals[i.values[k]],m="c"+l.id;if(void 0===e[m]&&(e[m]=e[m]||l.getRowIndexes().slice(0)),c[l.id]=b(j,e[m],a.isRoot?null:a.getRowIndexes()),!l.isLeaf&&(h.push(l),j)){e[m]=[];for(var n=0;n<j.length;n++){var o=j[n];-1!=o&&0>o&&(e[m].push(0-(o+2)),j[n]=-1)}}}e["c"+i.id]=void 0,g++}return c}}function d(){if(f.dataMatrix={},e={},f.dataMatrix[f.rows.root.id]=c(f.rows.root),f.rows.dimensionsCount>0)for(var a,b=[f.rows.root],d=0;d<b.length;){a=b[d];for(var g=0;g<a.values.length;g++){var h=a.subdimvals[a.values[g]];f.dataMatrix[h.id]=c(h),h.isLeaf||b.push(h)}d++}}var e,f=this;this.config=new orb.config(a),this.rows=new orb.axe(f,orb.axe.Type.ROWS),this.columns=new orb.axe(f,orb.axe.Type.COLUMNS),this.dataMatrix=[],this.moveField=function(a,b,c,e){f.config.moveField(a,b,c,e)&&(f.rows.update(),f.columns.update(),d())},this.getData=function(a,b){return a&&b?f.dataMatrix[a.id]?f.dataMatrix[a.id][b.id]||null:null:void 0},d()}}(),orb.utils.ns("orb.ui"),function(){function a(a){this.axetype=a.axetype,this.type=a.type,this.template=a.template,this.value=a.value,this.expanded=!0,this.cssclass=a.cssclass,this.hspan=a.hspan||function(){return 1},this.vspan=a.vspan||function(){return 1},this.visible=a.isvisible||function(){return!0}}orb.ui.header=function(b,c,d,e,f){function g(){if(l.type===orb.ui.HeaderType.SUB_TOTAL){for(var a=l.parent;null!=a;){if(a.subtotalHeader&&!a.subtotalHeader.expanded)return!1;a=a.parent}return!0}var b=l.dim.isRoot||l.dim.isLeaf||!l.dim.field.subtotal.visible||l.subtotalHeader.expanded;if(!b)return!1;for(var c=l.parent;null!=c&&(!c.dim.field.subtotal.visible||null!=c.subtotalHeader&&c.subtotalHeader.expanded);)c=c.parent;return null==c||null==c.subtotalHeader?b:c.subtotalHeader.expanded}function h(){var a,b=0,c=!1;if(l.visible()){if(l.dim.isLeaf)return 1;for(var d=0;d<l.subheaders.length;d++){var e=l.subheaders[d];e.dim.isLeaf?b+=1:(a=m?e.vspan():e.hspan(),b+=a,0===d&&(0===a||m&&e.type===orb.ui.HeaderType.SUB_TOTAL&&!e.expanded)&&(c=!0))}return b+(c?1:0)}return b}var i,j,k,l=this,m=b===orb.axe.Type.ROWS;switch(c=c||(1===d.depth?orb.ui.HeaderType.INNER:orb.ui.HeaderType.WRAPPER)){case orb.ui.HeaderType.GRAND_TOTAL:k="Grand Total",i=m?d.depth-1||1:1,j=m?1:d.depth-1||1;break;case orb.ui.HeaderType.SUB_TOTAL:k="Total "+d.value,i=m?d.depth:1,j=m?1:d.depth;break;default:k=d.value,i=m?1:null,j=m?null:1}a.call(this,{axetype:b,type:c,template:m?"cell-template-row-header":"cell-template-column-header",value:k,cssclass:orb.ui.HeaderType.getHeaderClass(c,b),hspan:null!=i?function(){return i}:h,vspan:null!=j?function(){return j}:h,isvisible:g}),this.subtotalHeader=f,this.parent=e,this.subheaders=[],this.dim=d,this.expanded=c!==orb.ui.HeaderType.SUB_TOTAL||!d.field.subtotal.collapsed,this.expand=function(){l.expanded=!0},this.collapse=function(){l.expanded=!1},null!=e&&e.subheaders.push(this)},orb.ui.dataCell=function(b,c,d,e){a.call(this,{axetype:null,type:orb.ui.HeaderType.DATA_VALUE,template:"cell-template-datavalue",value:b.getData(d.dim,e.dim),cssclass:"cell "+orb.ui.HeaderType.getCellClass(d.type,e.type),isvisible:c})},orb.ui.buttonCell=function(b){a.call(this,{axetype:null,type:orb.ui.HeaderType.FIELD_BUTTON,template:"cell-template-fieldbutton",value:b,cssclass:orb.ui.HeaderType.getHeaderClass(orb.ui.HeaderType.FIELD_BUTTON)})},orb.ui.emptyCell=function(b,c){a.call(this,{axetype:null,type:orb.ui.HeaderType.EMPTY,template:"cell-template-empty",value:null,cssclass:orb.ui.HeaderType.getHeaderClass(orb.ui.HeaderType.EMPTY),hspan:function(){return b},vspan:function(){return c}})}}(),orb.utils.ns("orb.ui"),function(){orb.ui.rows=function(a){function b(a,c){if(c.values.length>0)for(var d=a.length-1,e=a[d],f=e.length>0?e[e.length-1]:null,g=0;g<c.values.length;g++){var h,i=c.values[g],j=c.subdimvals[i];h=!j.isLeaf&&j.field.subtotal.visible?new orb.ui.header(orb.axe.Type.ROWS,orb.ui.HeaderType.SUB_TOTAL,j,f):null;var k=new orb.ui.header(orb.axe.Type.ROWS,null,j,f,h);0===g?e.push(k):a.push([k]),j.isLeaf||(b(a,j,h),j.field.subtotal.visible&&a.push([h]))}}var c=this;this.axe=a,this.uiInfos=[],this.build=function(){var a=[[]];if(null!=c.axe){b(a,c.axe.root);var d=a[a.length-1],e=new orb.ui.header(orb.axe.Type.ROWS,orb.ui.HeaderType.GRAND_TOTAL,c.axe.root);0===d.length?d.push(e):a.push([e])}c.uiInfos=a},this.build()}}(),orb.utils.ns("orb.ui"),function(){orb.ui.cols=function(a){function b(a,b){for(var d=b[b.length-1],e=c.axe.root.depth===a?[null]:b[c.axe.root.depth-a-1].filter(function(a){return a.type!==orb.ui.HeaderType.SUB_TOTAL}),f=0;f<e.length;f++)for(var g=e[f],h=null==g?c.axe.root:g.dim,i=0;i<h.values.length;i++){var j,k=h.values[i],l=h.subdimvals[k];j=!l.isLeaf&&l.field.subtotal.visible?new orb.ui.header(orb.axe.Type.COLUMNS,orb.ui.HeaderType.SUB_TOTAL,l,g):null;var m=new orb.ui.header(orb.axe.Type.COLUMNS,null,l,g,j);d.push(m),!l.isLeaf&&l.field.subtotal.visible&&d.push(j)}}var c=this;this.axe=a,this.uiInfos=null,this.build=function(){var a=[];if(null!=c.axe){for(var d=c.axe.root.depth;d>1;d--)a.push([]),b(d,a);(a[0]=a[0]||[]).push(new orb.ui.header(orb.axe.Type.COLUMNS,orb.ui.HeaderType.GRAND_TOTAL,c.axe.root))}c.uiInfos=a,console.log("fff")},this.getAllHeaders=function(){function a(a){a.dim.field.subtotal.visible&&d.push(a.subtotalHeader)}for(var b=c.uiInfos[c.uiInfos.length-1],d=[],e=b[0].parent,f=0;f<b.length;f++){var g=b[f];if(g.parent!=e){a(e);for(var h=g.parent.parent,i=e.parent;h!=i&&null!=i;)a(i),h=h.parent,i=i.parent;e=g.parent}if(d.push(g),null!=e&&f===b.length-1)for(a(e),i=e.parent;null!=i;)a(i),i=i.parent}return null!=b[0].parent&&d.push(c.uiInfos[0][c.uiInfos[0].length-1]),d},this.build()}}(),orb.utils.ns("orb.ui"),function(){orb.ui.pgridwidget=function(a){function b(){function b(a,b){return a.length!==b?(a.length=b,!0):!1}c.rows=new orb.ui.rows(a.rows),c.columns=new orb.ui.cols(a.columns);var d=c.rows.uiInfos,e=d.length,f=c.columns.uiInfos,g=f.length,h=c.columns.getAllHeaders(),i=h.length;c.rowHeadersWidth=a.rows.fields.length||1,c.columnHeadersWidth=i,c.rowHeadersHeight=e,c.columnHeadersHeight=a.columns.fields.length||1,c.totalWidth=c.rowHeadersWidth+c.columnHeadersWidth,c.totalHeight=c.rowHeadersHeight+c.columnHeadersHeight;for(var j=[],k=(b(j,g+e),0);g>k;k++){var l=f[k],m=j[k]=j[k]||[],n=0;if(g>1&&0===k)n=1,b(m,n+l.length),m[0]=new orb.ui.emptyCell(c.rowHeadersWidth,c.columnHeadersHeight-1);else if(k===g-1)if(n=c.rowHeadersWidth,b(m,n+l.length),c.pgrid.rows.fields.length>0)for(var o=0;o<c.pgrid.config.rowfields.length;o++)m[o]=new orb.ui.buttonCell(c.pgrid.config.rowfields[o]);else m[0]=new orb.ui.emptyCell(c.rowHeadersWidth,1);for(var p=0;p<l.length;p++)m[n+p]=l[p]}for(var q=0;e>q;q++){var r=d[q];m=j[g+q]=j[g+q]||new Array(r.length+i),b(m,r.length+i);for(var s=0;s<r.length;s++)m[s]=r[s];for(var t=r[r.length-1],u=0;i>u;u++){var v=h[u],w=function(a,b){return function(){return a()&&b()}}(t.visible,v.visible);m[r.length+u]=new orb.ui.dataCell(c.pgrid,w,t,v)}}c.cells=j}var c=this;null!=a&&(this.pgrid=a,this.rows=null,this.columns=null,this.rowHeadersWidth=null,this.columnHeadersWidth=null,this.rowHeadersHeight=null,this.columnHeadersHeight=null,this.totalWidth=null,this.totalWidth=null,this.sort=function(a,c){if(a===orb.axe.Type.ROWS)this.pgrid.rows.sort(c);else{if(a!==orb.axe.Type.COLUMNS)return;this.pgrid.columns.sort(c)}b()},this.moveField=function(a,c,d,e){this.pgrid.moveField(a,c,d,e),b()},this.filters=null,this.cells=[],b())},orb.ui.HeaderType={EMPTY:1,DATA_VALUE:2,FIELD_BUTTON:3,INNER:4,WRAPPER:5,SUB_TOTAL:6,GRAND_TOTAL:7,getHeaderClass:function(a,b){var c="";switch(a){case orb.ui.HeaderType.EMPTY:case orb.ui.HeaderType.FIELD_BUTTON:c="empty";break;case orb.ui.HeaderType.INNER:b===orb.axe.Type.ROWS?c="header":b===orb.axe.Type.COLUMNS&&(c="header");break;case orb.ui.HeaderType.WRAPPER:b===orb.axe.Type.ROWS?c="header":b===orb.axe.Type.COLUMNS&&(c="header");break;case orb.ui.HeaderType.SUB_TOTAL:c="header header-sub-total";break;case orb.ui.HeaderType.GRAND_TOTAL:c="header header-grand-total"}return c},getCellClass:function(a,b){var c="";switch(a){case orb.ui.HeaderType.GRAND_TOTAL:c="cell-grand-total";break;case orb.ui.HeaderType.SUB_TOTAL:c=b===orb.ui.HeaderType.GRAND_TOTAL?"cell-grand-total":"cell-sub-total";break;default:c=b===orb.ui.HeaderType.GRAND_TOTAL?"cell-grand-total":b===orb.ui.HeaderType.SUB_TOTAL?"cell-sub-total":"cell"}return c}}}(),orb.utils.ns("orb.react"),function(){orb.react.PivotTable=React.createClass({displayName:"PivotTable",getInitialState:function(){return orb.react.DragManager.init(this),{}},sort:function(a,b){this.props.data.sort(a,b),this.setProps(this.props)},moveButton:function(a,b,c){this.props.data.moveField(a.props.field.name,a.props.axetype,b,c),this.setProps(this.props)},expandRow:function(a){a.expanded=!0,this.setProps({})},collapseRow:function(a){a.subtotalHeader.expanded=!1,this.setProps({})},render:function(){var a=this,b=this.props.data,c=orb.react.PivotButton,d=orb.react.PivotRow,e=orb.react.DropTarget,f=b.pgrid.config.availablefields().map(function(b,d){return React.createElement(c,{key:b.name,field:b,axetype:null,position:d,rootComp:a})}),g=b.pgrid.config.datafields.map(function(b,d){return React.createElement(c,{key:b.name,field:b,axetype:orb.axe.Type.DATA,position:d,rootComp:a})}),h=b.pgrid.config.columnfields.map(function(b,d){return React.createElement(c,{key:b.name,field:b,axetype:orb.axe.Type.COLUMNS,position:d,rootComp:a})}),i=b.cells.filter(function(a){return"cell-template-fieldbutton"===a[0].template})[0];i=void 0!==i?i.filter(function(a){return"cell-template-fieldbutton"===a.template}).map(function(b,d){return React.createElement(c,{key:b.value.name,field:b.value,axetype:orb.axe.Type.ROWS,position:d,rootComp:a})}):[];var j=React.createElement("td",{className:"empty",colSpan:b.rowHeadersWidth,rowSpan:"1"},React.createElement(e,{data:i,axetype:orb.axe.Type.ROWS})),k=function(){for(var a=0;a<b.cells.length;a++)if("cell-template-row-header"===b.cells[a][0].template)return a-1;return-1}(),l=b.cells.map(function(c,e){return e==k?React.createElement(d,{key:e,row:c,rowButtonsCount:b.rowHeadersWidth,rowButtonsCell:j,rootComp:a}):React.createElement(d,{key:e,row:c,rootComp:a})}),m={width:"901px"};return React.createElement("table",{id:"tbl",className:"orb",style:m},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",{className:"empty",colSpan:"1",rowSpan:"1",className:"available-fields"},React.createElement("div",{className:"field-group-caption"},"Fields:")),React.createElement("td",{className:"empty",colSpan:b.totalWidth-1,rowSpan:"1",className:"available-fields"},React.createElement(e,{data:f,axetype:null}))),React.createElement("tr",null,React.createElement("td",{className:"empty",colSpan:"1",rowSpan:"1"},React.createElement("div",{className:"field-group-caption"},"Data fields:")),React.createElement("td",{className:"empty",colSpan:b.totalWidth-1,rowSpan:"1"},React.createElement(e,{data:g,axetype:orb.axe.Type.DATA}))),React.createElement("tr",null,React.createElement("td",{className:"empty",colSpan:b.rowHeadersWidth,rowSpan:"1"}),React.createElement("td",{className:"empty",colSpan:b.columnHeadersWidth,rowSpan:"1"},React.createElement(e,{data:h,axetype:orb.axe.Type.COLUMNS}))),l))}}),orb.react.PivotRow=React.createClass({displayName:"PivotRow",render:function(){var a,b=this,c=orb.react.PivotCell,d=this.props.row.length-1,e=this.props.row[0],f={};return void 0!==this.props.rowButtonsCell?(a=this.props.row.slice(this.props.rowButtonsCount).map(function(a,e){var f=e===d-b.props.rowButtonsCount;return React.createElement(c,{key:e,cell:a,rightmost:f,rootComp:b.props.rootComp})}),React.createElement("tr",null,this.props.rowButtonsCell,a)):("cell-template-row-header"==e.template&&e.visible&&!e.visible()&&(f.display="none"),a=this.props.row.map(function(a,e){var f=e===d;return React.createElement(c,{key:e,cell:a,rightmost:f,rootComp:b.props.rootComp})}),React.createElement("tr",{style:f},a))}}),orb.react.PivotCell=React.createClass({displayName:"PivotCell",expand:function(){this.props.rootComp.expandRow(this.props.cell)},collapse:function(){this.props.rootComp.collapseRow(this.props.cell)},render:function(){var a=this.props.cell,b=[];switch(a.template){case"cell-template-row-header":case"cell-template-column-header":a.type===orb.ui.HeaderType.WRAPPER&&a.dim.field.subtotal.visible&&a.dim.field.subtotal.collapsible&&a.subtotalHeader.expanded?b.push(React.createElement("span",{key:"toggle-button",className:"toggle-button",onClick:this.collapse},"\u25bc")):a.type!==orb.ui.HeaderType.SUB_TOTAL||a.expanded||b.push(React.createElement("span",{key:"toggle-button",className:"toggle-button",onClick:this.expand},"\u25b6"))}b.push(React.createElement("span",{key:"cell-value",style:{whiteSpace:"nowrap"}},a.value));var c=a.cssclass,d=!a.visible();return(d||this.props.rightmost)&&(d&&(c+=" cell-hidden"),!this.props.rightmost||a.axetype===orb.axe.Type.COLUMNS&&a.type!==orb.ui.HeaderType.GRAND_TOTAL||(c+=" cell-rightmost")),React.createElement("td",{className:c,colSpan:a.hspan(),rowSpan:a.vspan()},React.createElement("div",null,b))}})}(),orb.utils.ns("orb.react"),function(){function a(a,b,c){var d;if(null!=a)for(var e=0,f=a.length;f>e&&(d=b(a[e],e),void 0===d||c!==!0);e++);return d}function b(a){if(null!=a){var b=a.getBoundingClientRect();return{x:b.left,y:b.top}}return{x:0,y:0}}function c(a){if(null!=a){var b=a.getBoundingClientRect();return{width:b.right-b.left,height:b.bottom-b.top}}return{x:0,y:0}}orb.react.DragManager=function(){function b(a,b){return!(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom)}function c(a){return a.onDragOver?(a.onDragOver(h),!0):!1}function d(a){return a.onDragEnd?(a.onDragEnd(),!0):!1}function e(){return a(j,function(a){return a.component.state.isover?a:void 0},!0)}function f(){return a(k,function(a){return a.component.state.isover?a:void 0},!0)}var g=null,h=null,i=null,j=[],k=[],l=!1;return{init:function(a){l=!0,g=a},dragElement:function(b){var c=h;if(h=b,h!=c)if(null==b){var l=e(),m=f();if(l){var n=null!=m?m.position:null;g.moveButton(c,l.component.props.axetype,n)}i=null,a(j,function(a){d(a)}),a(k,function(a){d(a)})}else i=h.getDOMNode()},registerTarget:function(a,b,c,d){j.push({component:a,axetype:b,onDragOver:c,onDragEnd:d})},unregisterTarget:function(a){for(var b,c=0;c<j.length;c++)if(j[c].component==a){b=c;break}null!=b&&j.splice(b,1)},registerIndicator:function(a,b,c,d,e){k.push({component:a,axetype:b,position:c,onDragOver:d,onDragEnd:e})},unregisterIndicator:function(a){for(var b,c=0;c<k.length;c++)if(k[c].component==a){b=c;break}null!=b&&k.splice(b,1)},elementMoved:function(){if(null!=h){var e,f=i.getBoundingClientRect();a(j,function(a){if(!e){var g=a.component.getDOMNode().getBoundingClientRect(),h=b(f,g);if(h&&c(a))return e=a,!0;d(a)}},!0);var g;if(e){if(a(k,function(a){if(!g){var i=a.component.props.axetype===h.props.axetype&&a.component.props.position===h.props.position,j=a.component.props.axetype===e.component.props.axetype;if(j&&!i){var k=a.component.getDOMNode().getBoundingClientRect(),l=b(f,k);if(l&&c(a))return void(g=a)}}d(a)}),!g){var l=k.filter(function(a){return a.component.props.axetype===e.component.props.axetype});l.length>0&&c(l[l.length-1])}}else a(k,function(a){d(a)})}}}}();var d=0;orb.react.DropTarget=React.createClass({displayName:"DropTarget",getInitialState:function(){return this.dtid=++d,orb.react.DragManager.registerTarget(this,this.props.axetype,this.onDragOver,this.onDragEnd),{isover:!1}},componentWillUnmount:function(){orb.react.DragManager.unregisterTarget(this)},onDragOver:function(){this.setState({isover:!0})},onDragEnd:function(){this.setState({isover:!1})},render:function(){var a=this,b=orb.react.DropIndicator,c=this.props.data.map(function(c,d){return d<a.props.data.length-1?[React.createElement(b,{isFirst:0===d,position:d,axetype:a.props.axetype}),c]:[React.createElement(b,{isFirst:0===d,position:d,axetype:a.props.axetype}),c,React.createElement(b,{isLast:!0,position:null,axetype:a.props.axetype})]});return React.createElement("div",{className:"drop-target"+(this.state.isover?" drag-over":"")},c)}}),orb.react.DropIndicator=React.createClass({displayName:"DropIndicator",getInitialState:function(){return orb.react.DragManager.registerIndicator(this,this.props.axetype,this.props.position,this.onDragOver,this.onDragEnd),{isover:!1}},componentWillUnmount:function(){orb.react.DragManager.unregisterIndicator(this)},onDragOver:function(a){this.setState({isover:!0,width:a.getDOMNode().style.width})},onDragEnd:function(){this.setState({isover:!1,width:null})},render:function(){var a="drop-indicator";this.props.isFirst&&(a+=" drop-indicator-first"),this.props.isLast&&(a+=" drop-indicator-last");var b={};return this.state.isover&&(a+=" drop-indicator-drag-over"),React.createElement("div",{style:b,className:a})}});var e=0;orb.react.PivotButton=React.createClass({displayName:"PivotButton",getInitialState:function(){return this.pbid=++e,{pos:{x:0,y:0},startpos:{x:0,y:0},mousedown:!1,dragging:!1}},onMouseDown:function(a){if(0===a.button){var c=b(this.getDOMNode());this.setState({mousedown:!0,mouseoffset:{x:c.x-a.pageX,y:c.y-a.pageY},startpos:{x:a.pageX,y:a.pageY}}),a.stopPropagation(),a.preventDefault()}},componentDidUpdate:function(){this.state.mousedown?this.state.mousedown&&(orb.react.DragManager.dragElement(this),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)):(orb.react.DragManager.dragElement(null),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp))},componentWillUnmount:function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},onMouseUp:function(){var a=this.state.dragging;this.setState({mousedown:!1,dragging:!1,size:null,pos:{x:0,y:0}}),a||this.props.rootComp.sort(this.props.axetype,this.props.field)},onMouseMove:function(a){if(console.log("PivotButton["+this.pbid+"].onMouseMove"),this.state.mousedown){var b=null;b=this.state.dragging?this.state.size:c(this.getDOMNode());var d={x:a.pageX+this.state.mouseoffset.x,y:a.pageY+this.state.mouseoffset.y};this.setState({dragging:!0,size:b,pos:d}),orb.react.DragManager.elementMoved(),a.stopPropagation(),a.preventDefault()}},render:function(){var a=this,b={left:a.state.pos.x+"px",top:a.state.pos.y+"px",position:a.state.dragging?"absolute":""};a.state.size&&(b.width=a.state.size.width+"px");var c=(orb.react.DropIndicator,"asc"===a.props.field.sort.order?" \u25b3":"desc"===a.props.field.sort.order?" \u25bd":"");return React.createElement("div",{key:a.props.field.name,className:"field-button",onMouseDown:this.onMouseDown,style:b},a.props.field.caption,React.createElement("span",null,c))}})}();