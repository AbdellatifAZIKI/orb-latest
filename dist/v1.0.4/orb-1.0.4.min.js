/**
 * orb v1.0.4, Pivot grid javascript library.
 *
 * Copyright (c) 2014 Najmeddine Nouri <devnajm@gmail.com>.
 *
 * @version v1.0.4
 * @link http://nnajm.github.io/orb/
 * @license MIT
 */

"use strict";!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.orb=e()}}(function(){return function e(t,n,o){function r(i,s){if(!n[i]){if(!t[i]){var l="function"==typeof require&&require;if(!s&&l)return l(i,!0);if(a)return a(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[i]={exports:{}};t[i][0].call(d.exports,function(e){var n=t[i][1][e];return r(n?n:e)},d,d.exports,e,t,n,o)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<o.length;i++)r(o[i]);return r}({1:[function(e,t){t.exports.utils=e("./orb.utils"),t.exports.pgrid=e("./orb.pgrid"),t.exports.pgridwidget=e("./orb.ui.pgridwidget")},{"./orb.pgrid":7,"./orb.ui.pgridwidget":12,"./orb.utils":14}],2:[function(){},{}],3:[function(e,t){function n(e,t,n,r){var a=0,i=0,s=("all"===t?n:t).length;return s>0&&(r||s>1?(o(e,t,n,function(e){i+=e}),i/=s,o(e,t,n,function(e){a+=(e-i)*(e-i)}),a/=r?s:s-1):a=0/0),a}function o(e,t,n,o){var r="all"===t;if(t=r?n:t,t.length>0)for(var a=0;a<t.length;a++)o((r?t[a]:n[t[a]])[e])}t.exports={count:function(e,t,n){return"all"===t?n.length:t.length},sum:function(e,t,n){var r=0;return o(e,t,n,function(e){r+=e}),r},min:function(e,t,n){var r=null;return o(e,t,n,function(e){(null==r||r>e)&&(r=e)}),r},max:function(e,t,n){var r=null;return o(e,t,n,function(e){(null==r||e>r)&&(r=e)}),r},avg:function(e,t,n){var r=0,a=("all"===t?n:t).length;return a>0&&(o(e,t,n,function(e){r+=e}),r/=a),r},prod:function(e,t,n){var r,a=("all"===t?n:t).length;return a>0&&(r=1,o(e,t,n,function(e){r*=e})),r},stdev:function(e,t,o){return Math.sqrt(n(e,t,o,!1))},stdevp:function(e,t,o){return Math.sqrt(n(e,t,o,!0))},"var":function(e,t,o){return n(e,t,o,!1)},varp:function(e,t,o){return n(e,t,o,!0)}}},{}],4:[function(e,t){var n=e("./orb.utils"),o=e("./orb.dimension"),r={COLUMNS:1,ROWS:2,DATA:3};t.exports=function(e,t){function a(e){for(var t=0;t<s.fields.length;t++)if(s.fields[t].name===e.name)return t;return-1}function i(){if(null!=s.pgrid.config.dataSource&&s.dimensionsCount>0){var e=s.pgrid.config.dataSource;if(null!=e&&n.isArray(e)&&e.length>0)for(var t=0,r=e.length;r>t;t++)for(var a=e[t],i=s.root,u=0;u<s.dimensionsCount;u++){var d=s.dimensionsCount-u,c=s.fields[u],p=a[c.name],f=i.subdimvals;void 0!==f[p]?i=f[p]:(i.values.push(p),i=new o(++l,i,p,c,d,!1,u==s.dimensionsCount-1),f[p]=i,i.rowIndexes=[],s.dimensionsByDepth[d].push(i)),i.rowIndexes.push(t)}}}var s=this,l=0;null!=e&&null!=e.config&&(this.pgrid=e,this.type=t,this.fields=function(){switch(t){case r.COLUMNS:return s.pgrid.config.columnFields;case r.ROWS:return s.pgrid.config.rowFields;case r.DATA:return s.pgrid.config.dataFields;default:return[]}}(),this.dimensionsCount=null,this.root=null,this.dimensionsByDepth=null,this.update=function(){s.dimensionsCount=s.fields.length,s.root=new o(++l,null,null,null,s.dimensionsCount+1,!0),s.dimensionsByDepth={};for(var e=1;e<=s.dimensionsCount;e++)s.dimensionsByDepth[e]=[];i();for(var t=0;t<s.fields.length;t++){var n=s.fields[t];("asc"===n.sort.order||"desc"===n.sort.order)&&s.sort(n,!0)}},this.sort=function(e,t){if(null!=e){t!==!0&&(e.sort.order="asc"!==e.sort.order?"asc":"desc");for(var n=s.dimensionsCount-a(e),o=n===s.dimensionsCount?[s.root]:s.dimensionsByDepth[n+1],r=0;r<o.length;r++)o[r].values.sort(),"desc"===e.sort.order&&o[r].values.reverse()}},this.update())},t.exports.Type=r},{"./orb.dimension":6,"./orb.utils":14}],5:[function(e,t){function n(e,t,n){for(var o=0;o<t.length;o++)if(null!=t[o][e])return t[o][e];return n}function o(){for(var e=[],t=[],o=[],r=[],a=[],i=0;i<arguments.length;i++){var s=arguments[i]||{};e.push(s),t.push(s.sort||{}),o.push(s.subTotal||{}),r.push(s.filter||{}),a.push({aggregateFunc:0===i?s.aggregateFunc:s.aggregateFunc?s.aggregateFunc():null,formatFunc:0===i?s.formatFunc:s.formatFunc?s.formatFunc():null})}return new c({name:n("name",e,""),caption:n("caption",e,""),filter:{type:n("type",r,"operator"),regexp:n("regexp",r,null),operator:n("operator",r,null),value:n("value",r,null)},sort:{order:n("order",t,null),customfunc:n("customfunc",t,null)},subTotal:{visible:n("visible",o,!0),collapsible:n("collapsible",o,!0),collapsed:n("collapsed",o,!1)},aggregateFunc:n("aggregateFunc",a,null),formatFunc:n("formatFunc",a,null)},!1)}function r(e,t,n,r){var a;if(r)switch(t){case u.Type.ROWS:a=r.rowSettings;break;case u.Type.COLUMNS:a=r.columnSettings;break;case u.Type.DATA:a=r.dataSettings;break;default:a=null}else a=null;return o(n,a,r,e)}function a(e){e=e||{},this.rowsvisible=void 0!==e.rowsvisible?e.rowsvisible:!0,this.columnsvisible=void 0!==e.columnsvisible?e.columnsvisible:!0}function i(e,t){var n={visible:t===!0?!0:void 0,collapsible:t===!0?!0:void 0,collapsed:t===!0?!1:void 0};e=e||{},this.visible=void 0!==e.visible?e.visible:n.visible,this.collapsible=void 0!==e.collapsible?e.collapsible:n.collapsible,this.collapsed=void 0!==e.collapsed?e.collapsed:n.collapsed}function s(e){e=e||{},this.order=e.order,this.customfunc=e.customfunc}function l(e){e=e||{},this.type=e.type,this.regexp=e.regexp,this.operator=e.operator,this.value=e.value}var u=e("./orb.axe"),d=e("./orb.aggregation"),c=t.exports.field=function(e,t){function n(e){return e?e.toString():""}e=e||{},this.name=e.name,this.caption=e.caption||this.name,this.filter=new l(e.filter),this.sort=new s(e.sort),this.subTotal=new i(e.subTotal);var o,r;this.aggregateFunc=function(e){return e?void(o="string"==typeof e&&d[e]?d[e]:"function"==typeof e?e:d.sum):o},this.formatFunc=function(e){return e?void(r=e):r},this.aggregateFunc(e.aggregateFunc||"sum"),this.formatFunc(e.formatFunc||n),t!==!1&&((this.rowSettings=new c(e.rowSettings,!1)).name=this.name,(this.columnSettings=new c(e.columnSettings,!1)).name=this.name,(this.dataSettings=new c(e.dataSettings,!1)).name=this.name)};t.exports.config=function(e){function t(e,t){var o=n(e,t);return o>-1?e[o]:null}function n(e,t){for(var n=0;n<e.length;n++)if(e[n].name===t)return n;return-1}var o=this;this.dataSource=e.dataSource,this.dataHeadersLocation="columns"===e.dataHeadersLocation?"columns":"rows",this.grandTotal=new a(e.grandTotal),this.subTotal=new i(e.subTotal,!0),this.allFields=(e.fields||[]).map(function(e){return new c(e)}),this.rowFields=(e.rows||[]).map(function(e){return r(o,u.Type.ROWS,e,t(o.allFields,e.name))}),this.columnFields=(e.columns||[]).map(function(e){return r(o,u.Type.COLUMNS,e,t(o.allFields,e.name))}),this.dataFields=(e.data||[]).map(function(e){return r(o,u.Type.DATA,e,t(o.allFields,e.name))}),this.dataFieldsCount=this.dataFields?this.dataFields.length||1:1,o.availablefields=function(){return o.allFields.filter(function(e){var t=function(t){return e.name!==t.name};return o.dataFields.every(t)&&o.rowFields.every(t)&&o.columnFields.every(t)})},this.moveField=function(e,a,i,s){var l,d,c,p=t(o.allFields,e);if(p){switch(a){case u.Type.ROWS:l=o.rowFields;break;case u.Type.COLUMNS:l=o.columnFields;break;case u.Type.DATA:l=o.dataFields}switch(i){case u.Type.ROWS:c=o.rowFields;break;case u.Type.COLUMNS:c=o.columnFields;break;case u.Type.DATA:c=o.dataFields}if(l||c){if(l){if(d=n(l,e),a===i&&(d==l.length-1&&null==s||d===s-1))return!1;l.splice(d,1)}return p=r(o,i,null,p),c&&(null!=s?c.splice(s,0,p):c.push(p)),o.dataFieldsCount=o.dataFields?o.dataFields.length||1:1,!0}}}}},{"./orb.aggregation":3,"./orb.axe":4}],6:[function(e,t){t.exports=function(e,t,n,o,r,a,i){var s=this;this.id=e,this.parent=t,this.value=n,this.isRoot=a,this.isLeaf=i,this.field=o,this.depth=r,this.values=[],this.subdimvals={},this.rowIndexes=null,this.getRowIndexes=function(e){if(null==s.rowIndexes){this.rowIndexes=[];for(var t=0;t<s.values.length;t++)s.subdimvals[s.values[t]].getRowIndexes(this.rowIndexes)}if(null!=e){for(var n=0;n<s.rowIndexes.length;n++)e.push(s.rowIndexes[n]);return e}return s.rowIndexes}}},{}],7:[function(e,t){var n=e("./orb.axe"),o=e("./orb.config").config,r=e("./orb.query");t.exports=function(e){function t(e,t,n){var o={};if(u.config.dataFieldsCount>0){var r;if(null==e)r=t;else if(null==t)r=e;else{r=[];for(var a=0;a<e.length;a++){var i=e[a];if(i>=0){var s=t.indexOf(i);s>=0&&(e[a]=0-(i+2),r.push(i))}}}for(var d=u.config.dataSource,c=0;c<u.config.dataFieldsCount;c++){var p=u.config.dataFields[c]||l;p.aggregateFunc&&(o[p.name]=p.aggregateFunc()(p.name,r||"all",d,n,t))}}return o}function a(e){if(e){var n={},o="r"+e.id;if(void 0===s[o]&&(s[o]=e.isRoot?null:s[e.parent.id]||e.getRowIndexes()),n[u.columns.root.id]=t(e.isRoot?null:s[o].slice(0),null),u.columns.dimensionsCount>0)for(var r=0,a=[u.columns.root];r<a.length;){for(var i=a[r],l=e.isRoot?null:i.isRoot?s[o].slice(0):s["c"+i.id].slice(0),d=0;d<i.values.length;d++){var c=i.subdimvals[i.values[d]],p="c"+c.id;if(void 0===s[p]&&(s[p]=s[p]||c.getRowIndexes().slice(0)),n[c.id]=t(l,s[p],e.isRoot?null:e.getRowIndexes()),!c.isLeaf&&(a.push(c),l)){s[p]=[];for(var f=0;f<l.length;f++){var h=l[f];-1!=h&&0>h&&(s[p].push(0-(h+2)),l[f]=-1)}}}s["c"+i.id]=void 0,r++}return n}}function i(){if(u.dataMatrix={},s={},u.dataMatrix[u.rows.root.id]=a(u.rows.root),u.rows.dimensionsCount>0)for(var e,t=[u.rows.root],n=0;n<t.length;){e=t[n];for(var o=0;o<e.values.length;o++){var r=e.subdimvals[e.values[o]];u.dataMatrix[r.id]=a(r),r.isLeaf||t.push(r)}n++}}var s,l={name:"#undefined#"},u=this;this.config=new o(e),this.rows=new n(u,n.Type.ROWS),this.columns=new n(u,n.Type.COLUMNS),this.dataMatrix={},this.moveField=function(e,t,n,o){u.config.moveField(e,t,n,o)&&(u.rows.update(),u.columns.update(),i())},this.getData=function(e,t,n){return t&&n?(e=e||(u.config.dataFields[0]||l).name,u.dataMatrix[t.id]&&u.dataMatrix[t.id][n.id]?u.dataMatrix[t.id][n.id][e]||null:null):void 0},this.query=r(u),i()}},{"./orb.axe":4,"./orb.config":5,"./orb.query":8}],8:[function(e,t){var n=e("./orb.axe");t.exports=function(e){return function(t){function o(e,t,n){return function(o){var r={name:t,val:o,depth:n};return(l[e]=l[e]||[]).push(r),s}}function r(t){if(l[t]){for(var o=l[t].sort(function(e,t){return t.depth-e.depth}),r=0,a=null;r<o.length;)a=e[t===n.Type.ROWS?"rows":"columns"].dimensionsByDepth[o[r].depth].filter(function(e){return e.value===o[r].val&&(0===r||a.some(function(t){for(var n=e.parent,o=e.depth+1;o<t.depth;)n=n.parent,o++;return n===t}))}),r++;return a}return null}function a(e){return u[e]?u[e]:e}function i(t,o){return t=a(t),function(){for(var i=r(n.Type.ROWS)||[e.rows.root],s=r(n.Type.COLUMNS)||[e.columns.root],l=[],u=0;u<i.length;u++)for(var d=0;d<s.length;d++){var c,p=i[u],f=s[d];if(o!==!0)if(c={},p.isRoot||(c[p.field.name]=p.value),f.isRoot||(c[f.field.name]=f.value),0==arguments.length)c[t||"data"]=e.getData(t,p,f);else{for(var h={},m=0;m<arguments.length;m++)h[arguments[m]]=e.getData(a(arguments[m]),p,f);c.data=h}else if(c=[],0==arguments.length)c.push(e.getData(t,p,f));else for(var m=0;m<arguments.length;m++)c.push(e.getData(a(arguments[m]),p,f));l.push(c)}return l}}for(var s={},l={},u={},d=e.config.rowFields,c=e.config.columnFields,p=e.config.dataFields,f=0;f<d.length;f++){var h=d[f],m=o(n.Type.ROWS,h.name,d.length-f);s[h.name]=m,h.caption&&h.name!==h.caption&&(s[h.caption]=m,u[h.caption]=h.name)}for(var g=0;g<c.length;g++){var v=c[g],y=o(n.Type.COLUMNS,v.name,c.length-g);s[c[g].name]=y,v.caption&&v.name!==v.caption&&(s[v.caption]=y,u[v.caption]=v.name)}for(var b=0;b<p.length;b++){var x=p[b];s[x.name]=i(x.name),s[x.name].flat=i(x.name,!0),x.caption&&x.name!==x.caption&&(s[x.caption]=s[x.name],s[x.caption].flat=s[x.name].flat,u[x.caption]=x.name)}if(s.data=i(),s.data.flat=i(void 0,!0),t)for(var w in t)t.hasOwnProperty(w)&&s[w](t[w]);return s}}},{"./orb.axe":4}],9:[function(e,t){t.exports=function(){var e={};this.set=function(t,n){e[t]=n},this.get=function(t){return e[t]}}},{}],10:[function(e,t){var n=e("./orb.axe"),o=e("./orb.ui.header");t.exports=function(e){function t(){function e(e){e&&e.dim.field.subTotal.visible&&t.push(e.subtotalHeader)}var t=[];if(a.uiInfos.length>0){for(var n,r=a.uiInfos[a.uiInfos.length-1],l=r[0],u=l.parent,d=0;d<r.length;d++){if(l=r[d],n=l.parent,n!=u){if(e(u),null!=n)for(var c=n.parent,p=u?u.parent:null;c!=p&&null!=p;)e(p),c=c?c.parent:null,p=p?p.parent:null;u=n}if(t.push(r[d]),d===r.length-1)for(;null!=u;)e(u),u=u.parent}a.axe.pgrid.config.grandTotal.columnsvisible&&a.axe.dimensionsCount>1&&t.push(a.uiInfos[0][a.uiInfos[0].length-1])}if(i){a.leafsHeaders=[];for(var f=0;f<t.length;f++)for(var h=0;s>h;h++)a.leafsHeaders.push(new o.dataHeader(a.axe.pgrid.config.dataFields[h],t[f]));a.uiInfos.push(a.leafsHeaders)}else a.leafsHeaders=t}function r(e,t){for(var r=t[t.length-1],i=a.axe.root.depth===e?[null]:t[a.axe.root.depth-e-1].filter(function(e){return e.type!==o.HeaderType.SUB_TOTAL}),l=0;l<i.length;l++)for(var u=i[l],d=null==u?a.axe.root:u.dim,c=0;c<d.values.length;c++){var p,f=d.values[c],h=d.subdimvals[f];p=!h.isLeaf&&h.field.subTotal.visible?new o.header(n.Type.COLUMNS,o.HeaderType.SUB_TOTAL,h,u,s):null;var m=new o.header(n.Type.COLUMNS,null,h,u,s,p);r.push(m),!h.isLeaf&&h.field.subTotal.visible&&r.push(p)}}var a=this;this.axe=e,this.uiInfos=null,this.leafsHeaders=null;var i,s;this.build=function(){if(s="columns"===a.axe.pgrid.config.dataHeadersLocation?a.axe.pgrid.config.dataFieldsCount:1,i="columns"===a.axe.pgrid.config.dataHeadersLocation&&s>1,a.uiInfos=[],null!=a.axe){for(var e=a.axe.root.depth;e>1;e--)a.uiInfos.push([]),r(e,a.uiInfos);a.axe.pgrid.config.grandTotal.columnsvisible&&(a.uiInfos[0]=a.uiInfos[0]||[]).push(new o.header(n.Type.COLUMNS,o.HeaderType.GRAND_TOTAL,a.axe.root,null,s)),0===a.uiInfos.length&&a.uiInfos.push([new o.header(n.Type.COLUMNS,o.HeaderType.INNER,a.axe.root,null,s)]),t()}},this.build()}},{"./orb.axe":4,"./orb.ui.header":11}],11:[function(e,t){function n(e){this.axetype=e.axetype,this.type=e.type,this.template=e.template,this.value=e.value,this.expanded=!0,this.cssclass=e.cssclass,this.hspan=e.hspan||function(){return 1},this.vspan=e.vspan||function(){return 1},this.visible=e.isvisible||function(){return!0},this.key=this.axetype+this.type+this.value,this.getState=function(){return r.get(this.key)},this.setState=function(e){r.set(this.key,e)}}var o=e("./orb.axe"),r=new(e("./orb.state")),a=t.exports.HeaderType={EMPTY:1,DATA_HEADER:2,DATA_VALUE:3,FIELD_BUTTON:4,INNER:5,WRAPPER:6,SUB_TOTAL:7,GRAND_TOTAL:8,getHeaderClass:function(e,t){var n="";switch(e){case a.EMPTY:case a.FIELD_BUTTON:n="empty";break;case a.INNER:n="header";break;case a.WRAPPER:t===o.Type.ROWS?n="header":t===o.Type.COLUMNS&&(n="header");break;case a.SUB_TOTAL:n="header header-sub-total";break;case a.GRAND_TOTAL:n="header header-grand-total"}return n},getCellClass:function(e,t){var n="";switch(e){case a.GRAND_TOTAL:n="cell-grand-total";break;case a.SUB_TOTAL:n=t===a.GRAND_TOTAL?"cell-grand-total":"cell-sub-total";break;default:n=t===a.GRAND_TOTAL?"cell-grand-total":t===a.SUB_TOTAL?"cell-sub-total":"cell"}return n}};t.exports.header=function(e,t,r,i,s,l){function u(){if(h.type===a.SUB_TOTAL){for(var e=h.parent;null!=e;){if(e.subtotalHeader&&!e.subtotalHeader.expanded)return!1;e=e.parent}return!0}var t=h.dim.isRoot||h.dim.isLeaf||!h.dim.field.subTotal.visible||h.subtotalHeader.expanded;if(!t)return!1;for(var n=h.parent;null!=n&&(!n.dim.field.subTotal.visible||null!=n.subtotalHeader&&n.subtotalHeader.expanded);)n=n.parent;return null==n||null==n.subtotalHeader?t:n.subtotalHeader.expanded}function d(){var e,t=0,n=!1;if(h.visible()){if(h.dim.isLeaf)return s;for(var o=0;o<h.subheaders.length;o++){var r=h.subheaders[o];r.dim.isLeaf?t+=s:(e=m?r.vspan():r.hspan(),t+=e,0===o&&(0===e||m&&r.type===a.SUB_TOTAL&&!r.expanded)&&(n=!0))}return t+(n?1:0)}return t}var c,p,f,h=this,m=e===o.Type.ROWS;switch(t=t||(1===r.depth?a.INNER:a.WRAPPER)){case a.GRAND_TOTAL:f="Grand Total",c=m?r.depth-1||1:s,p=m?s:r.depth-1||1;break;case a.SUB_TOTAL:f="Total "+r.value,c=m?r.depth:s,p=m?s:r.depth;break;default:f=r.value,c=m?1:null,p=m?null:1}n.call(this,{axetype:e,type:t,template:m?"cell-template-row-header":"cell-template-column-header",value:f,cssclass:a.getHeaderClass(t,e),hspan:null!=c?function(){return c}:d,vspan:null!=p?function(){return p}:d,isvisible:u}),this.subtotalHeader=l,this.parent=i,this.subheaders=[],this.dim=r,this.expanded=this.getState()?this.getState().expanded:t!==a.SUB_TOTAL||!r.field.subTotal.collapsed,this.expand=function(){h.expanded=!0,this.setState({expanded:h.expanded})},this.collapse=function(){h.expanded=!1,this.setState({expanded:h.expanded})},null!=i&&i.subheaders.push(this)},t.exports.dataHeader=function(e,t){n.call(this,{axetype:null,type:a.DATA_HEADER,template:"cell-template-dataheader",value:e,cssclass:a.getHeaderClass(t.type),isvisible:t.visible}),this.parent=t},t.exports.dataCell=function(e,t,o,r){this.rowDimension=o.type===a.DATA_HEADER?o.parent.dim:o.dim,this.columnDimension=r.type===a.DATA_HEADER?r.parent.dim:r.dim,this.rowType=o.type===a.DATA_HEADER?o.parent.type:o.type,this.colType=r.type===a.DATA_HEADER?r.parent.type:r.type,this.datafield=e.config.dataFieldsCount>1?"rows"===e.config.dataHeadersLocation?o.value:r.value:e.config.dataFields[0],n.call(this,{axetype:null,type:a.DATA_VALUE,template:"cell-template-datavalue",value:e.getData(this.datafield?this.datafield.name:null,this.rowDimension,this.columnDimension),cssclass:"cell "+a.getCellClass(this.rowType,this.colType),isvisible:t})},t.exports.buttonCell=function(e){n.call(this,{axetype:null,type:a.FIELD_BUTTON,template:"cell-template-fieldbutton",value:e,cssclass:a.getHeaderClass(a.FIELD_BUTTON)})},t.exports.emptyCell=function(e,t){n.call(this,{axetype:null,type:a.EMPTY,template:"cell-template-empty",value:null,cssclass:a.getHeaderClass(a.EMPTY),hspan:function(){return e},vspan:function(){return t}})}},{"./orb.axe":4,"./orb.state":9}],12:[function(e,t){var n=e("./orb.axe"),o=e("./orb.pgrid"),r=e("./orb.ui.header"),a=e("./orb.ui.rows"),i=e("./orb.ui.cols"),s=e("./react/orb.react.compiled");t.exports=function(e){function t(){function e(e,t){return e.length!==t?(e.length=t,!0):!1}function t(e,t){return function(){return e()&&t()}}u.rows=new a(u.pgrid.rows),u.columns=new i(u.pgrid.columns);var n=u.rows.uiInfos,o=n.length,s=u.columns.uiInfos,l=s.length,d=u.columns.leafsHeaders,c=d.length;u.rowHeadersWidth=(u.pgrid.rows.fields.length||1)+("rows"===u.pgrid.config.dataHeadersLocation&&u.pgrid.config.dataFieldsCount>1?1:0),u.columnHeadersWidth=c,u.rowHeadersHeight=o,u.columnHeadersHeight=(u.pgrid.columns.fields.length||1)+("columns"===u.pgrid.config.dataHeadersLocation&&u.pgrid.config.dataFieldsCount>1?1:0),u.totalWidth=u.rowHeadersWidth+u.columnHeadersWidth,u.totalHeight=u.rowHeadersHeight+u.columnHeadersHeight;var p=[];e(p,l+o);for(var f,h=0;l>h;h++){var m=s[h],g=0;if(f=p[h]=p[h]||[],l>1&&0===h)g=1,e(f,g+m.length),f[0]=new r.emptyCell(u.rowHeadersWidth,u.columnHeadersHeight-1);else if(h===l-1)if(g=u.rowHeadersWidth,e(f,g+m.length),u.pgrid.rows.fields.length>0)for(var v=0;v<u.pgrid.config.rowFields.length;v++)f[v]=new r.buttonCell(u.pgrid.config.rowFields[v]);else f[0]=new r.emptyCell(u.rowHeadersWidth,1);for(var y=0;y<m.length;y++)f[g+y]=m[y]}for(var b=0;o>b;b++){var x=n[b];f=p[l+b]=p[l+b]||new Array(x.length+c),e(f,x.length+c);for(var w=0;w<x.length;w++)f[w]=x[w];for(var T=x[x.length-1],R=0;c>R;R++){var E=d[R],S=t(T.visible,E.visible);f[x.length+R]=new r.dataCell(u.pgrid,S,T,E)}}u.cells=p}var l,u=this;this.pgrid=new o(e),this.rows=null,this.columns=null,this.rowHeadersWidth=null,this.columnHeadersWidth=null,this.rowHeadersHeight=null,this.columnHeadersHeight=null,this.totalWidth=null,this.totalWidth=null,this.sort=function(e,o){if(e===n.Type.ROWS)u.pgrid.rows.sort(o);else{if(e!==n.Type.COLUMNS)return;u.pgrid.columns.sort(o)}t()},this.moveField=function(e,n,o,r){u.pgrid.moveField(e,n,o,r),t()},this.filters=null,this.cells=[],this.render=function(t){if(l=t){var n=React.createFactory(s.PivotTable),o=n({data:u,config:e});React.render(o,t)}},this.drilldown=function(e,t){if(e){var n=e.columnDimension.getRowIndexes(),o=e.rowDimension.getRowIndexes().filter(function(e){return n.indexOf(e)>=0}).map(function(e){return u.pgrid.config.dataSource[e]}),r=u.pgrid.config.allFields.map(function(e){return e.caption}),a=React.createFactory(s.Dialog),i=a({headers:r,data:o,pivotId:t});React.render(i,document.getElementById("drilldialog"+t))}},t()}},{"./orb.axe":4,"./orb.pgrid":7,"./orb.ui.cols":10,"./orb.ui.header":11,"./orb.ui.rows":13,"./react/orb.react.compiled":15}],13:[function(e,t){var n=e("./orb.axe"),o=e("./orb.ui.header");t.exports=function(e){function t(e,t){if(i)for(var n=e[e.length-1],r=0;s>r;r++)n.push(new o.dataHeader(a.axe.pgrid.config.dataFields[r],t)),s-1>r&&e.push(n=[])}function r(e,a){if(a.values.length>0)for(var i=e.length-1,l=e[i],u=l.length>0?l[l.length-1]:null,d=0;d<a.values.length;d++){var c,p=a.values[d],f=a.subdimvals[p];c=!f.isLeaf&&f.field.subTotal.visible?new o.header(n.Type.ROWS,o.HeaderType.SUB_TOTAL,f,u,s):null;var h=new o.header(n.Type.ROWS,null,f,u,s,c);d>0&&e.push(l=[]),l.push(h),f.isLeaf?t(e,h):(r(e,f),f.field.subTotal.visible&&(e.push([c]),t(e,c)))}}var a=this;this.axe=e,this.uiInfos=[];var i,s;this.build=function(){s="rows"===a.axe.pgrid.config.dataHeadersLocation?a.axe.pgrid.config.dataFieldsCount||1:1,i="rows"===a.axe.pgrid.config.dataHeadersLocation&&s>1;var e=[[]];if(null!=a.axe){if(r(e,a.axe.root),a.axe.pgrid.config.grandTotal.rowsvisible){var l=e[e.length-1],u=new o.header(n.Type.ROWS,o.HeaderType.GRAND_TOTAL,a.axe.root,null,s);0===l.length?l.push(u):e.push([u]),t(e,u)}0===e[0].length&&e[0].push(new o.header(n.Type.ROWS,o.HeaderType.INNER,a.axe.root,null,s))}a.uiInfos=e},this.build()}},{"./orb.axe":4,"./orb.ui.header":11}],14:[function(e,t){t.exports={ns:function(e,t){var n=e.split("."),o=0;for(t=t||window;o<n.length;)t[n[o]]=t[n[o]]||{},t=t[n[o]],o++;return t},ownProperties:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},findInArray:function(e,t){if(this.isArray(e)&&t)for(var n=0;n<e.length;n++){var o=e[n];if(t(o))return o}return void 0},jsonStringify:function(e,t){function n(e,n){return t&&t.indexOf(e)>-1?void 0:n}return JSON.stringify(e,n,2)}}},{}],15:[function(e,t){function n(e,t,n){var o;if(null!=e)for(var r=0,a=e.length;a>r&&(o=t(e[r],r),void 0===o||n!==!0);r++);return o}function o(e){if(null!=e){var t=e.getBoundingClientRect();return{x:t.left+0,y:t.top+0}}return{x:0,y:0}}function r(e){if(null!=e){var t=e.getBoundingClientRect();return{width:t.right-t.left,height:t.bottom-t.top}}return{x:0,y:0}}var a="undefined"==typeof window?e("react"):window.React,i=e("../orb.utils"),s=e("../orb.axe"),l=e("../orb.ui.header"),u=1,d=1,c=t.exports;t.exports.PivotTable=a.createClass({getInitialState:function(){return c.DragManager.init(this),{}},id:u++,sort:function(e,t){this.props.data.sort(e,t),this.setProps(this.props)},moveButton:function(e,t,n){this.props.data.moveField(e.props.field.name,e.props.axetype,t,n),this.setProps(this.props)},expandRow:function(e){e.expand(),this.setProps({})},collapseRow:function(e){e.subtotalHeader.collapse(),this.setProps({})},render:function(){var e=this,t=this.props.data,n=c.PivotButton,o=c.PivotRow,r=c.DropTarget,a=t.pgrid.config.availablefields().map(function(t,o){return React.createElement(n,{key:t.name,field:t,axetype:null,position:o,rootComp:e})}),l=t.pgrid.config.dataFields.map(function(t,o){return React.createElement(n,{key:t.name,field:t,axetype:s.Type.DATA,position:o,rootComp:e})}),u=t.pgrid.config.columnFields.map(function(t,o){return React.createElement(n,{key:t.name,field:t,axetype:s.Type.COLUMNS,position:o,rootComp:e})}),p=i.findInArray(t.cells,function(e){return"cell-template-fieldbutton"===e[0].template});p=void 0!==p?p.filter(function(e){return"cell-template-fieldbutton"===e.template}).map(function(t,o){return React.createElement(n,{key:t.value.name,field:t.value,axetype:s.Type.ROWS,position:o,rootComp:e})}):[];var f=React.createElement("td",{className:"empty",colSpan:t.rowHeadersWidth+d,rowSpan:"1"},React.createElement(r,{data:p,axetype:s.Type.ROWS})),h=t.cells.map(function(n,r){return r==t.columnHeadersHeight-1?React.createElement(o,{key:r,row:n,rowButtonsCount:t.rowHeadersWidth,rowButtonsCell:f,rootComp:e}):React.createElement(o,{key:r,row:n,rootComp:e})}),m={};return this.props.config.width&&(m.width=this.props.config.width),this.props.config.height&&(m.height=this.props.config.height),React.createElement("div",{className:"orb-container",style:m},React.createElement("table",{id:"{'tbl' + self.id}",className:"orb",style:{width:"100%"}},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",{className:"available-fields field-group",colSpan:d,rowSpan:"1"},React.createElement("div",{className:"field-group-caption"},"Fields")),React.createElement("td",{className:"available-fields",colSpan:t.totalWidth,rowSpan:"1"},React.createElement(r,{data:a,axetype:null}))),React.createElement("tr",null,React.createElement("td",{className:"field-group",colSpan:d,rowSpan:"1"},React.createElement("div",{className:"field-group-caption"},"Data")),React.createElement("td",{className:"empty",colSpan:t.totalWidth,rowSpan:"1"},React.createElement(r,{data:l,axetype:s.Type.DATA}))),React.createElement("tr",null,React.createElement("td",{className:"empty",colSpan:t.rowHeadersWidth+d,rowSpan:"1"}),React.createElement("td",{className:"empty",colSpan:t.columnHeadersWidth,rowSpan:"1"},React.createElement(r,{data:u,axetype:s.Type.COLUMNS}))),h)),React.createElement("div",{className:"orb-overlay orb-overlay-hidden",id:"drilldialog"+e.id}))}}),t.exports.PivotRow=a.createClass({render:function(){var e,t=this,n=c.PivotCell,o=this.props.row.length-1,r=this.props.row[0],a={};return void 0!==this.props.rowButtonsCell?(e=this.props.row.slice(this.props.rowButtonsCount).map(function(e,r){var a=r===o-t.props.rowButtonsCount;return React.createElement(n,{key:r,cell:e,rightmost:a,leftmost:!1,rootComp:t.props.rootComp})}),React.createElement("tr",null,this.props.rowButtonsCell,e)):("cell-template-row-header"==r.template&&r.visible&&!r.visible()&&(a.display="none"),e=this.props.row.map(function(e,r){var a=r===o,i=0===r&&(e.type===l.HeaderType.EMPTY||e.type===l.HeaderType.SUB_TOTAL&&e.dim.parent.isRoot||e.type===l.HeaderType.GRAND_TOTAL||e.dim&&(e.dim.isRoot||e.dim.parent.isRoot));return React.createElement(n,{key:r,cell:e,rightmost:a,leftmost:i,rootComp:t.props.rootComp})}),React.createElement("tr",{style:a},e))}}),t.exports.PivotCell=a.createClass({expand:function(){this.props.rootComp.expandRow(this.props.cell)},collapse:function(){this.props.rootComp.collapseRow(this.props.cell)},render:function(){var e,t,n=this,o=this.props.cell,r=[];switch(o.template){case"cell-template-row-header":case"cell-template-column-header":o.type===l.HeaderType.WRAPPER&&o.dim.field.subTotal.visible&&o.dim.field.subTotal.collapsible&&o.subtotalHeader.expanded?r.push(React.createElement("span",{key:"toggle-button",className:"toggle-button toggle-button-down",onClick:this.collapse})):o.type!==l.HeaderType.SUB_TOTAL||o.expanded||r.push(React.createElement("span",{key:"toggle-button",className:"toggle-button toggle-button-right",onClick:this.expand})),e=o.value;break;case"cell-template-dataheader":e=o.value.caption;break;case"cell-template-datavalue":e=o.datafield&&o.datafield.formatFunc?o.datafield.formatFunc()(o.value):o.value,t=function(){n.props.rootComp.props.data.drilldown(o,n.props.rootComp.id)}}r.push(React.createElement("span",{key:"cell-value",style:{whiteSpace:"nowrap"}},e));var a=o.cssclass,i=!o.visible();return(i||this.props.rightmost||this.props.leftmost)&&(i&&(a+=" cell-hidden"),!this.props.rightmost||o.axetype===s.Type.COLUMNS&&o.type!==l.HeaderType.GRAND_TOTAL||(a+=" cell-rightmost"),this.props.leftmost&&(a+=" cell-leftmost")),("cell-template-column-header"===o.template||"cell-template-dataheader"===o.template)&&(a+=" centered"),React.createElement("td",{className:a,onDoubleClick:t,colSpan:o.hspan()+(this.props.leftmost?d:0),rowSpan:o.vspan()},React.createElement("div",null,r))}}),t.exports.Grid=a.createClass({render:function(){var e=this.props.data,t=this.props.headers,n=[];if(t&&t.length>0){for(var o=[],r=0;r<t.length;r++)o.push(React.createElement("th",null,t[r]));n.push(React.createElement("tr",null,o))}if(e&&e.length>0)for(var a=0;a<e.length;a++){for(var i=[],s=0;s<e.length;s++)i.push(React.createElement("td",null,e[a][s]));n.push(React.createElement("tr",null,i))}return React.createElement("table",null,React.createElement("tbody",null,n))}}),t.exports.Dialog=a.createClass({overlayElement:null,componentDidMount:function(){this.overlayElement=document.getElementById("drilldialog"+this.props.pivotId),this.overlayElement.className="orb-overlay orb-overlay-visible",this.overlayElement.addEventListener("click",this.close);var e=this.overlayElement.children[0],t=Math.max(document.documentElement.clientWidth,window.innerWidth||0),n=Math.max(document.documentElement.clientHeight,window.innerHeight||0);e.style.top=(n>e.offsetHeight?(n-e.offsetHeight)/2:0)+"px",e.style.left=(t>e.offsetWidth?(t-e.offsetWidth)/2:0)+"px"},close:function(){this.overlayElement&&(this.overlayElement.removeEventListener("click",this.close),React.unmountComponentAtNode(this.overlayElement),this.overlayElement.className="orb-overlay orb-overlay-hidden")},render:function(){var e=c.Grid;return React.createElement("div",{className:"orb-dialog"},React.createElement("div",{className:"orb-dialog-body"},React.createElement(e,{headers:this.props.headers,data:this.props.data})))}});var p=t.exports.DragManager=function(){function e(e,t){return!(e.right<t.left||e.left>t.right||e.bottom<t.top||e.top>t.bottom)}function t(e){return e.onDragOver?(e.onDragOver(s),!0):!1}function o(e){return e.onDragEnd?(e.onDragEnd(),!0):!1}function r(){return n(u,function(e){return e.component.state.isover?e:void 0},!0)}function a(){return n(d,function(e){return e.component.state.isover?e:void 0},!0)}var i=null,s=null,l=null,u=[],d=[],c=!1;return{init:function(e){c=!0,i=e},dragElement:function(e){var t=s;if(s=e,s!=t)if(null==e){var c=r(),p=a();if(c){var f=null!=p?p.position:null;i.moveButton(t,c.component.props.axetype,f)}l=null,n(u,function(e){o(e)}),n(d,function(e){o(e)})}else l=s.getDOMNode()},registerTarget:function(e,t,n,o){u.push({component:e,axetype:t,onDragOver:n,onDragEnd:o})},unregisterTarget:function(e){for(var t,n=0;n<u.length;n++)if(u[n].component==e){t=n;break}null!=t&&u.splice(t,1)},registerIndicator:function(e,t,n,o,r){d.push({component:e,axetype:t,position:n,onDragOver:o,onDragEnd:r})},unregisterIndicator:function(e){for(var t,n=0;n<d.length;n++)if(d[n].component==e){t=n;break}null!=t&&d.splice(t,1)},elementMoved:function(){if(null!=s){var r,a=l.getBoundingClientRect();n(u,function(n){if(!r){var i=n.component.getDOMNode().getBoundingClientRect(),s=e(a,i);if(s&&t(n))return r=n,!0;o(n)}},!0);var i;if(r){if(n(d,function(n){if(!i){var l=n.component.props.axetype===s.props.axetype&&n.component.props.position===s.props.position,u=n.component.props.axetype===r.component.props.axetype;if(u&&!l){var d=n.component.getDOMNode().getBoundingClientRect(),c=e(a,d);if(c&&t(n))return void(i=n)}}o(n)}),!i){var c=d.filter(function(e){return e.component.props.axetype===r.component.props.axetype});c.length>0&&t(c[c.length-1])}}else n(d,function(e){o(e)})}}}}(),f=0;t.exports.DropTarget=a.createClass({getInitialState:function(){return this.dtid=++f,p.registerTarget(this,this.props.axetype,this.onDragOver,this.onDragEnd),{isover:!1}},componentWillUnmount:function(){p.unregisterTarget(this)},onDragOver:function(){this.setState({isover:!0})},onDragEnd:function(){this.setState({isover:!1})},render:function(){var e=this,n=t.exports.DropIndicator,o=this.props.data.map(function(t,o){return o<e.props.data.length-1?[React.createElement(n,{isFirst:0===o,position:o,axetype:e.props.axetype}),t]:[React.createElement(n,{isFirst:0===o,position:o,axetype:e.props.axetype}),t,React.createElement(n,{isLast:!0,position:null,axetype:e.props.axetype})]
});return React.createElement("div",{className:"drop-target"+(this.state.isover?" drag-over":"")},o)}}),t.exports.DropIndicator=a.createClass({displayName:"DropIndicator",getInitialState:function(){return p.registerIndicator(this,this.props.axetype,this.props.position,this.onDragOver,this.onDragEnd),{isover:!1}},componentWillUnmount:function(){p.unregisterIndicator(this)},onDragOver:function(e){this.setState({isover:!0,width:e.getDOMNode().style.width})},onDragEnd:function(){this.setState({isover:!1,width:null})},render:function(){var e="drop-indicator";this.props.isFirst&&(e+=" drop-indicator-first"),this.props.isLast&&(e+=" drop-indicator-last");var t={};return this.state.isover&&(e+=" drop-indicator-drag-over"),React.createElement("div",{style:t,className:e})}});var h=0;t.exports.PivotButton=a.createClass({displayName:"PivotButton",getInitialState:function(){return this.pbid=++h,{pos:{x:0,y:0},startpos:{x:0,y:0},mousedown:!1,dragging:!1}},onMouseDown:function(e){if(0===e.button){var t=o(this.getDOMNode());this.setState({mousedown:!0,mouseoffset:{x:t.x-e.pageX,y:t.y-e.pageY},startpos:{x:e.pageX,y:e.pageY}}),e.stopPropagation(),e.preventDefault()}},componentDidUpdate:function(){this.state.mousedown?this.state.mousedown&&(p.dragElement(this),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)):(p.dragElement(null),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp))},componentWillUnmount:function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},onMouseUp:function(){var e=this.state.dragging;this.setState({mousedown:!1,dragging:!1,size:null,pos:{x:0,y:0}}),e||this.props.rootComp.sort(this.props.axetype,this.props.field)},onMouseMove:function(e){if(this.state.mousedown){var t=null;t=this.state.dragging?this.state.size:r(this.getDOMNode());var n={x:e.pageX+this.state.mouseoffset.x,y:e.pageY+this.state.mouseoffset.y};this.setState({dragging:!0,size:t,pos:n}),p.elementMoved(),e.stopPropagation(),e.preventDefault()}},render:function(){var e=this,n={left:e.state.pos.x+"px",top:e.state.pos.y+"px",position:e.state.dragging?"fixed":""};e.state.size&&(n.width=e.state.size.width+"px");var o=(t.exports.DropIndicator,"asc"===e.props.field.sort.order?" \u2191":"desc"===e.props.field.sort.order?" \u2193":"");return React.createElement("div",{key:e.props.field.name,className:"field-button",onMouseDown:this.onMouseDown,style:n},e.props.field.caption,React.createElement("span",null,o))}})},{"../orb.axe":4,"../orb.ui.header":11,"../orb.utils":14,react:2}]},{},[1])(1)});

//# sourceMappingURL=orb-1.0.4.min.js.map