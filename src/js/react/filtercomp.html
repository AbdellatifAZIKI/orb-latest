<html>
<head>
	<style type="text/css">

	.filter-container {
		position: fixed;
		background-color: white;
		border: 1px solid darkorange;
	    font-size: 90%;
	    width: 183px;
	    
	}

    .filter-value {
    	white-space: nowrap;
		text-overflow: ellipsis;
		overflow: hidden;
    }

    .filter-checkbox {
		width: 16px;
    }

    .filter-values-table-container {
    	width: 180px;
    	height: 162px;
		overflow-y: auto;
    	overflow-x: hidden;
    }

    .filter-values-table {
    	table-layout: fixed;
    	width: 163px;
    }

    .filter-confirm-buttons {
    	width: 183px;
    	float:left;
    	box-sizing: border-box;
    	padding: 3px 0;
    	border-top: 1px solid darkorange;
    	margin-top: 3px;
    }

    .filter-search-box {
    	width: 183px;
    	float:left;
    	box-sizing: border-box;
    	padding: 3px 3px;
    }

    .filter-search-box input {
    	width: 100%;
    	border: 1px solid darkorange;
    }    

	.orb-button {	
		font-weight: bold;
		text-align: center;
	    padding: 3px;
	    margin-right: 3px;
	    cursor: pointer;
		background-color: darkorange;
		color: white;
	    border: darkorange;		    
	}
	</style>

	<script type="text/javascript">

	/*var checked = [];
	var checkboxes = {};
	var checkboxValues = [];
	var searchChecked = [];
	var isSearchMode = false;
	
	var filterContainer;
	var searchBox;
	var allCheckbox;
	var log;*/

	function filterManager(reatComp, filterContainerElement, checkedValues) {

		var self = this;

		var ALL = '#All#';
		var NONE = '#None#';
		var INDETERMINATE = 'indeterminate';

		var checked = [];
		var allValues = [];
		var searchCheckedValues = [];
		var isSearchMode = false;

		var elems = {
			filterContainer: null,
			checkboxes: {},
			searchBox: null,
			allCheckbox: null,
			addCheckbox: null,
			enableRegexButton: null,
			okButton: null,
			cancelButton: null,
		};

		this.checkedValues = [];

		this.reset = function(newFilterContaineElement, newCheckedValues) {
			this.checkedValues = [];
			allValues = [];
			searchCheckedValues = [];
			isSearchMode = false;

			elems.filterContainer = newFilterContaineElement;
			elems.checkboxes = {};
			elems.searchBox = elems.filterContainer.children[0].children[0];
			elems.okButton = elems.filterContainer.children[2].children[0];
			elems.cancelButton = elems.filterContainer.children[2].children[1];

			var rows = elems.filterContainer.children[1].children[0].rows;
			for(var i = 0; i < rows.length; i++) {
				var checkbox = rows[i].cells[0].children[0];
				elems.checkboxes[checkbox.value] = checkbox;
				allValues.push(checkbox.value);
			}

			elems.allCheckbox = elems.checkboxes[ALL];
			elems.addCheckbox = null;
			elems.enableRegexButton = null;

			elems.filterContainer.addEventListener('click', self.valueChecked);
			elems.searchBox.addEventListener('keyup', self.searchChanged);
			elems.okButton.addEventListener('click', function() { alert('ok'); });
			elems.cancelButton.addEventListener('click', function() { alert('cancel'); });

			self.updateCheckboxes(newCheckedValues);
		}

		this.valueChecked = function(e) {
			var target = e.target;
			if(target && target.type && target.type === 'checkbox') {
				self.updateCheckedValues(target == elems.allCheckbox);
				//log.textContent = JSON.stringify(self.checkedValues, null, 2) + '\n' + JSON.stringify(searchCheckedValues, null, 2);
			}
		}

		this.searchChanged = function() {
			var search = (elems.searchBox.value || '').trim();
			isSearchMode = search != '';
			var defaultDisplay = search ? 'none' : '';

			elems.allCheckbox.parentNode.parentNode.style.display = defaultDisplay;
			for(var i = 1; i < allValues.length; i++) {
				var val = allValues[i];
				var checkbox = elems.checkboxes[val];
				var visible = !isSearchMode || val.match(search) != null;
				checkbox.parentNode.parentNode.style.display = visible ? '' : defaultDisplay;
				checkbox.checked = visible;
			}

			if(!isSearchMode) {
				searchCheckedValues = [];
				self.updateCheckboxes(self.checkedValues);
			} else {
				self.updateCheckedValues();
			}
		}

		this.updateCheckedValues = function(allChecked) {
			if(allChecked) {
				self.checkedValues = elems.allCheckbox.checked ? ALL : NONE;
				self.updateCheckboxes(elems.allCheckbox.checked, ALL);
			} else {
				var checkedArray = [];
				for(var i = 1; i < allValues.length; i++) {
					var val = allValues[i];
					var checkbox = elems.checkboxes[val];
					if(checkbox.checked) {
						checkedArray.push(val);
					}
				}

				if(isSearchMode) {
					searchCheckedValues = checkedArray;
				} else {
					self.checkedValues = checkedArray;
				}
				self.updateAllCheckbox();
			}
		}

		this.updateCheckboxes = function(checkedList, source) {
			var allchecked = Object.prototype.toString.apply(checkedList) === '[object Array]' ? null : (checkedList == null ? true : !!checkedList);
			for(var i = 1; i < allValues.length; i++) {
				var val = allValues[i];
				elems.checkboxes[val].checked = allchecked != null ? allchecked : checkedList.indexOf(val) >= 0;
			}

			if(source !== ALL) {
				self.checkedValues = checkedList || (allchecked ? ALL : NONE);
				self.updateAllCheckbox();
			}
		}

		this.updateAllCheckbox = function() {
			if(!isSearchMode) {
				var allchecked = null;
				for(var i = 1; i < allValues.length; i++) {
					var checkbox = elems.checkboxes[allValues[i]];
					if(allchecked == null) {
						allchecked = checkbox.checked;
					} else {
						if(allchecked !== checkbox.checked) {
							allchecked = INDETERMINATE;
							break;
						}
					}
				}

				if(allchecked === INDETERMINATE) {
					elems.allCheckbox.indeterminate = true;
				} else {
					elems.allCheckbox.indeterminate = false;
					elems.allCheckbox.checked = allchecked;
				}
			}
		}

		this.reset(filterContainerElement, checkedValues);
	}

	window.onload = function() {
		var filterMan = new filterManager(null, document.getElementById('filter-container'), ['sdfgsdgcb', 'xcvwxvb', 'azeaze']);
	}	

	</script>
</head>
<body>

<div id="filter-container" class="filter-container">
	<div class="filter-search-box">
		<input type="text" placeholder="search"/>
	</div>
	<div class="filter-values-table-container">
		<table class="filter-values-table">
		<tbody>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="#All#" defaultChecked="checked"/></td>
				<td class="filter-value" title="(Show All)">(Show All)</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="sdfgsdgcb" defaultChecked="checked"/></td>
				<td class="filter-value" title="sdfgsdgcb">sdfgsdgcb</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="xcvbxcvb" defaultChecked="checked"/></td>
				<td class="filter-value" title="xcvbxcvb">xcvbxcvb</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="dsfgdg" defaultChecked="checked"/></td>
				<td class="filter-value" title="dsfgdg">dsfgdg</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="xcvwxvb" defaultChecked="checked"/></td>
				<td class="filter-value" title="xcvwxvb">xcvwxvb</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="gsdfgdsfg" defaultChecked="checked"/></td>
				<td class="filter-value" title="gsdfgdsfg">gsdfgdsfg</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="azeaze" defaultChecked="checked"/></td>
				<td class="filter-value" title="azeaze">azeaze</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="erdhbvcv" defaultChecked="checked"/></td>
				<td class="filter-value" title="erdhbvcv">erdhbvcv</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="qsfqsf" defaultChecked="checked"/></td>
				<td class="filter-value" title="qsfqsf">qsfqsf</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="xwcvwxcv" defaultChecked="checked"/></td>
				<td class="filter-value" title="xwcvwxcv">xwcvwxcv</td>
			</tr>
		</tbody>
		</table>
	</div>
	<div class="filter-confirm-buttons">
		<input type="button" class="orb-button" value="Ok" style="float: right;"/>
		<input type="button" class="orb-button" value="Cancel" style="float: right;"/>
	</div>
</div>

<div id="filter-container" class="filter-container">
	<div class="filter-search-box">
		<input type="text" placeholder="search"/>
	</div>
	<div class="filter-values-table-container">
		<table class="filter-values-table">
		<tbody>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="#All#" defaultChecked="checked"/></td>
				<td class="filter-value" title="(Show All)">(Show All)</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="sdfgsdgcb" defaultChecked="checked"/></td>
				<td class="filter-value" title="sdfgsdgcb">sdfgsdgcb</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="xcvbxcvb" defaultChecked="checked"/></td>
				<td class="filter-value" title="xcvbxcvb">xcvbxcvb</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="dsfgdg" defaultChecked="checked"/></td>
				<td class="filter-value" title="dsfgdg">dsfgdg</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="xcvwxvb" defaultChecked="checked"/></td>
				<td class="filter-value" title="xcvwxvb">xcvwxvb</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="gsdfgdsfg" defaultChecked="checked"/></td>
				<td class="filter-value" title="gsdfgdsfg">gsdfgdsfg</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="azeaze" defaultChecked="checked"/></td>
				<td class="filter-value" title="azeaze">azeaze</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="erdhbvcv" defaultChecked="checked"/></td>
				<td class="filter-value" title="erdhbvcv">erdhbvcv</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="qsfqsf" defaultChecked="checked"/></td>
				<td class="filter-value" title="qsfqsf">qsfqsf</td>
			</tr>
			<tr>
				<td class="filter-checkbox"><input type="checkbox" value="xwcvwxcv" defaultChecked="checked"/></td>
				<td class="filter-value" title="xwcvwxcv">xwcvwxcv</td>
			</tr>
		</tbody>
		</table>
	</div>
	<div class="filter-confirm-buttons">
		<input type="button" class="orb-button" value="Ok" style="float: right;"/>
		<input type="button" class="orb-button" value="Cancel" style="float: right;"/>
	</div>
</div>
<pre id="checked" style="position: fixed;left: 201px;"></pre>
</body>
</html>